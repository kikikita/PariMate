from aiogram import Router
from aiogram.types import ChatMemberUpdated
from aiogram.filters import ChatMemberUpdatedFilter, IS_MEMBER, IS_NOT_MEMBER
from aiogram.enums import ParseMode
from core.database.bd import bd_user_select


router = Router()


def join_message(habit: str):
    # habit_list = [
    #     '–∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–ø–æ—Ä—Ç–æ–º', '–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∏—Ç–∞—Ç—å—Å—è', '–ø–∏—Ç—å –≤–æ–¥—É',
    #     '–ø—Ä–∏–Ω–∏–º–∞—Ç—å –¥–æ–±–∞–≤–∫–∏', '–¥–µ–ª–∞—Ç—å –∑–∞—Ä—è–¥–∫—É', '–≥—É–ª—è—Ç—å',
    #     '–∏–∑—É—á–∞—Ç—å –Ω–æ–≤—ã–π –Ω–∞–≤—ã–∫', '—á–∏—Ç–∞—Ç—å', '–ø—Ä–æ—Ö–æ–¥–∏—Ç—å —É—á–µ–±–Ω—ã–π –∫—É—Ä—Å',
    #     '–≤–µ—Å—Ç–∏ –¥–Ω–µ–≤–Ω–∏–∫', '–∏–∑—É—á–∞—Ç—å –Ω–æ–≤—ã–π —è–∑—ã–∫', '–º–µ–¥–∏—Ç–∏—Ä–æ–≤–∞—Ç—å',
    #     '—Å–æ–±–ª—é–¥–∞—Ç—å —Ä–µ–∂–∏–º —Å–Ω–∞', '–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ –¥–µ–Ω—å',
    #     '–ø—Ä–æ–≤–æ–¥–∏—Ç—å –º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ']
    if habit == '–∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–ø–æ—Ä—Ç–æ–º':
        text = '–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.'
    elif habit == '–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∏—Ç–∞—Ç—å—Å—è':
        text = ('–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ñ–æ—Ç–æ –µ–¥—ã, –∫–æ—Ç–æ—Ä—É—é –ø–æ—Ç—Ä–µ–±–ª—è–µ—à—å/' +
                '—Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∫–∞–ª–æ—Ä–∏–π.')
    elif habit == '–ø–∏—Ç—å –≤–æ–¥—É':
        text = ('–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ñ–æ—Ç–æ –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –±—É—Ç—ã–ª–∫–∏ –≤–æ–¥—ã —É—Ç—Ä–æ–º, –∞ ' +
                '–≤–µ—á–µ—Ä–æ–º –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–æ—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ –±—É—Ç—ã–ª–∫–∞ –ø—É—Å—Ç–∞.')
    elif habit == '–ø—Ä–∏–Ω–∏–º–∞—Ç—å –¥–æ–±–∞–≤–∫–∏':
        text = '–∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏—Å—ã–ª–∞—Ç—å –¥–æ–±–∞–≤–æ–∫ –¥–æ –∏—Ö –ø—Ä–∏–µ–º–∞.'
    elif habit == '–¥–µ–ª–∞—Ç—å –∑–∞—Ä—è–¥–∫—É':
        text = '–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ, –∫–∞–∫ –¥–µ–ª–∞–µ—à—å –∑–∞—Ä—è–¥–∫—É —Å —É—Ç—Ä–∞.'
    elif habit == '–≥—É–ª—è—Ç—å':
        text = '–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ-–∫—Ä—É–∂–æ—á–∫–∏ —Å –ø—Ä–æ–≥—É–ª–∫–∏.'
    elif habit == '–∏–∑—É—á–∞—Ç—å –Ω–æ–≤—ã–π –Ω–∞–≤—ã–∫':
        text = '–ø—Ä–∏—Å—ã–ª–∞—Ç—å –≤–∏–¥–µ–æ-–∫—Ä—É–∂–æ—á–µ–∫ —Å —Ç–µ–º, –∫–∞–∫ —Ä–∞–∑–≤–∏–≤–∞–µ—à—å –Ω–æ–≤—ã–π –Ω–∞–≤—ã–∫.'
    elif habit == '—á–∏—Ç–∞—Ç—å':
        text = ('–ø—Ä–∏—Å—ã–ª–∞—Ç—å –∫—Ä—É–∂–æ—á–µ–∫ —Å —Ç–µ–º, –∫–∞–∫ —á–∏—Ç–∞–µ—à—å, ' +
                '–∫—Ä–∞—Ç–∫–æ –ø–µ—Ä–µ—Å–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ –∑–∞ —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥.')
    elif habit == '–ø—Ä–æ—Ö–æ–¥–∏—Ç—å —É—á–µ–±–Ω—ã–π –∫—É—Ä—Å':
        text = ('–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫—É—Ä—Å–∞, –æ–ø–∏—Å—ã–≤–∞—Ç—å,' +
                '–ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã, –∫–∞–∫–∏–µ –±—ã–ª–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.')
    elif habit == '–≤–µ—Å—Ç–∏ –¥–Ω–µ–≤–Ω–∏–∫':
        text = ('–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç/—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ ' +
                '—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–∂–Ω–æ –∑–∞–±–ª—é—Ä–∏—Ç—å) –¥–Ω–µ–≤–Ω–∏–∫–∞, –æ–ø–∏—Å—ã–≤–∞—Ç—å, ' +
                '–≥–¥–µ –±—ã–ª–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è.')
    elif habit == '–∏–∑—É—á–∞—Ç—å –Ω–æ–≤—ã–π —è–∑—ã–∫':
        text = '–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ/—Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π/—Ç–µ—Å—Ç–æ–≤.'
    elif habit == '–º–µ–¥–∏—Ç–∏—Ä–æ–≤–∞—Ç—å':
        text = ('–æ–ø–∏—Å—ã–≤–∞—Ç—å, –∫–∞–∫–∏–µ –±—ã–ª–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ ' +
                '—ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è, –∞ —Ç–∞–∫–∂–µ —Ç–æ, —á—Ç–æ –±—ã–ª–æ —É—Å–ø–µ—à–Ω—ã–º/–ø—Ä–∏—è—Ç–Ω—ã–º.')
    elif habit == '—Å–æ–±–ª—é–¥–∞—Ç—å —Ä–µ–∂–∏–º —Å–Ω–∞':
        text = ('–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ-–∫—Ä—É–∂–æ—á–∫–∏ –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–¥—ä–µ–º–∞,' +
                '–∞ —Ç–∞–∫–∂–µ –ø—Ä–∏—Å—ã–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "–ó–¥–æ—Ä–æ–≤—å–µ", ' +
                '–≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≤ —Ç–≤–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω.')
    elif habit == '–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ –¥–µ–Ω—å':
        text = ('–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é/—Å–∫—Ä–∏–Ω—à–æ—Ç/ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–µ–ª,' +
                '–æ–ø–∏—Å—ã–≤–∞—Ç—å, –≥–¥–µ –±—ã–ª–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.')
    elif habit == '–ø—Ä–æ–≤–æ–¥–∏—Ç—å –º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ':
        text = '–ø—Ä–∏—Å—ã–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç —ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ.'
    else:
        return ''
    return (f'\n\n–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Å–≤–æ–µ–π –ø—Ä–∏–≤—ã—á–∫–∏, —Ç—ã –º–æ–∂–µ—à—å {text} ' +
            '–ï—Å–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Ç–µ–±–µ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –≤—ã ' +
            '–≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è —Å –Ω–∞–ø–∞—Ä–Ω–∏–∫–æ–º –æ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ–º ' +
            '–≤–∞—Ä–∏–∞–Ω—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ. –í–µ–¥—å –≥–ª–∞–≤–Ω–æ–µ - —ç—Ç–æ ' +
            '–≤–∞—à –∫–æ–º—Ñ–æ—Ä—Ç –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç!')


@router.chat_member(ChatMemberUpdatedFilter(IS_NOT_MEMBER >> IS_MEMBER))
async def on_user_join(event: ChatMemberUpdated):

    user = await bd_user_select(event.new_chat_member.user.id)
    days_string = (str(user["habit_notification_day"])[1:-1]
                   .replace("'", ""))
    time_string = (str(user["habit_notification_time"])[1:-1]
                   .replace("'", ""))
    await event.answer(
        f'–ü—Ä–∏–≤–µ—Ç, <b>{user["name"]}</b>! –í —ç—Ç–æ–º —á–∞—Ç–µ, –≤—ã —Å –Ω–∞–ø–∞—Ä–Ω–∏–∫–æ–º –±—É–¥–µ—Ç–µ' +
        ' –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤–∞–º–∏ –ø—Ä–∏–≤—ã—á–µ–∫.' +
        '\n–ù–æ –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –Ω–∞—á–∞—Ç—å, –≤–æ—Ç —Ç–µ–±–µ –ø–∞—Ä–æ—á–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–πüëá',
        parse_mode=ParseMode.HTML)
    text = join_message(user["habit_choice"].lower())
    await event.answer(
        f'–¢–≤–æ—è —Ü–µ–ª—å - <b>{user["habit_choice"].lower()} ' +
        f'{user["habit_frequency"]} —Ä–∞–∑(-–∞) –≤ –Ω–µ–¥–µ–ª—é</b>' +
        f'\n–ü–æ —ç—Ç–∏–º –¥–Ω—è–º: {days_string}\n–í —ç—Ç–æ –≤—Ä–µ–º—è: {time_string}'
        '\n\n–í —Ç–µ—á–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–µ–π –Ω–µ–¥–µ–ª–∏ –ø—Ä–∏—Å—ã–ª–∞–π —Å—é–¥–∞ —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ-' +
        '–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫ –≤–Ω–µ–¥—Ä—è–µ—à—å –ø—Ä–∏–≤—ã—á–∫—É –≤ —Å–≤–æ—é –∂–∏–∑–Ω—å. ' +
        '–î–ª—è —ç—Ç–æ–≥–æ –∂–º–∏ /pari -> "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏"' +
        f'{text}' +
        '\n\n–†–∞—Å—Å–∫–∞–∑—ã–≤–∞–π—Ç–µ –æ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è—Ö –∏ —É—Å–ø–µ—Ö–∞—Ö, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –¥—Ä—É–≥ –¥—Ä—É–≥–∞,' +
        ' –∏ –ø–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –≤—ã –∑–¥–µ—Å—å –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å—Ç–∞—Ç—å –ª—É—á—à–µ–π –≤–µ—Ä—Å–∏–µ–π —Å–µ–±—è!' +
        '\n–î–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º –ø–∞—Ä–∏, –∂–º–∏ /help',
        parse_mode=ParseMode.HTML)
    await event.answer(
        '–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä —Å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º, –º–æ–∂–µ—à—å –∑–∞–¥–∞—Ç—å –µ–º—É –≤–æ–ø—Ä–æ—Å, ' +
        '–∑–∞—á–µ–º –æ–Ω —Ö–æ—á–µ—Ç –¥–æ—Å—Ç–∏—á—å —Å–≤–æ–µ–π —Ü–µ–ª–∏ –∏ –≤—ã—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É?')


@router.chat_member(ChatMemberUpdatedFilter(IS_MEMBER >> IS_NOT_MEMBER))
async def on_user_left(event: ChatMemberUpdated):
    await event.answer(f'–ü—Ä–æ—â–∞–π, {(event.old_chat_member.user.first_name)}')
